function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

/* eslint-disable no-param-reassign */

import { isFunction } from '../utils';


export default function urlMiddleware(opts) {
  const urlOrThunk = opts && opts.url || '/graphql';
  const fetchOpts = opts && opts.opts || null;

  return next => req => {
    if (fetchOpts) {
      const { headers } = fetchOpts,
            otherOpts = _objectWithoutProperties(fetchOpts, ['headers']);
      Object.assign(req, otherOpts);
      if (headers) {
        Object.assign(req.headers, headers);
      }
    }

    if (req.relayReqType !== 'batch-query') {
      // $FlowFixMe
      req.url = isFunction(urlOrThunk) ? urlOrThunk(req) : urlOrThunk;
    }

    return next(req);
  };
}